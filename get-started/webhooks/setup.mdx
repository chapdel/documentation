---
title: Webhook Setup
description: Learn how to set up and configure webhooks to receive real-time notifications from Notch Pay
---

# Setting Up Webhooks

<Note>
  Webhooks allow you to receive real-time notifications when events occur in your Notch Pay account, such as when a payment is completed or a transfer is processed.
</Note>

## Why Use Webhooks?

Webhooks provide several advantages over polling the API or relying on callbacks:

- **Real-time updates**: Receive notifications immediately when events occur
- **Reliability**: Don't miss events even if a customer closes their browser
- **Efficiency**: Reduce API calls by only processing data when changes occur
- **Automation**: Automatically trigger actions in your system based on events

## Webhook Setup Process

<Steps>
  <Step title="Create an Endpoint">
    First, create an endpoint on your server that can receive POST requests. This endpoint will process webhook events from Notch Pay.

    <CodeGroup>
      ```javascript Node.js (Express)
      const express = require('express');
      const app = express();
      
      // Parse JSON request body
      app.use(express.json());
      
      app.post('/webhooks/notchpay', (req, res) => {
        const event = req.body;
        
        // Verify the webhook signature (recommended)
        // Process the event based on its type
        console.log('Received event:', event.type);
        
        // Always return a 200 response quickly
        res.status(200).send('Webhook received');
      });
      
      app.listen(3000, () => {
        console.log('Webhook server running on port 3000');
      });
      ```

      ```php PHP
      <?php
      // Get the request body
      $payload = file_get_contents('php://input');
      $event = json_decode($payload, true);
      
      // Verify the webhook signature (recommended)
      // Process the event based on its type
      error_log('Received event: ' . $event['type']);
      
      // Always return a 200 response quickly
      http_response_code(200);
      echo 'Webhook received';
      ```

      ```python Python (Flask)
      from flask import Flask, request, jsonify
      
      app = Flask(__name__)
      
      @app.route('/webhooks/notchpay', methods=['POST'])
      def handle_webhook():
          event = request.json
          
          # Verify the webhook signature (recommended)
          # Process the event based on its type
          print(f"Received event: {event['type']}")
          
          # Always return a 200 response quickly
          return jsonify(message='Webhook received'), 200
      
      if __name__ == '__main__':
          app.run(port=3000)
      ```
    </CodeGroup>

    <Callout type="warning">
      Your webhook endpoint must be publicly accessible over the internet. For development, you can use a tool like [ngrok](https://ngrok.com/) to expose your local server.
    </Callout>
  </Step>
  
  <Step title="Register Your Webhook">
    Next, register your webhook endpoint with Notch Pay. You can do this through the dashboard or using the API.

    ### Using the Dashboard

    1. Log in to your [Notch Pay Business account](https://business.notchpay.co)
    2. Go to **Settings** > **Webhooks**
    3. Click **Add Endpoint**
    4. Enter your endpoint URL and select the events you want to receive
    5. Click **Save**

    ### Using the API

    ```javascript
    const response = await fetch('https://api.notchpay.co/webhooks', {
      method: 'POST',
      headers: {
        'Authorization': 'YOUR_API_KEY',
        'X-Grant': 'YOUR_PRIVATE_KEY',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        url: 'https://example.com/webhooks/notchpay',
        events: ['payment.complete', 'payment.failed', 'transfer.complete'],
        description: 'Production webhook endpoint'
      })
    });
    
    const data = await response.json();
    console.log('Webhook created:', data);
    ```
  </Step>
  
  <Step title="Verify Webhook Signatures">
    To ensure that webhook events are actually coming from Notch Pay, you should verify the signature included in each webhook request.

    <CodeGroup>
      ```javascript Node.js
      const crypto = require('crypto');
      
      function verifyWebhookSignature(payload, signature, secret) {
        const hmac = crypto.createHmac('sha256', secret);
        const calculatedSignature = hmac.update(payload).digest('hex');
        return crypto.timingSafeEqual(
          Buffer.from(calculatedSignature, 'hex'),
          Buffer.from(signature, 'hex')
        );
      }
      
      app.post('/webhooks/notchpay', (req, res) => {
        const payload = JSON.stringify(req.body);
        const signature = req.headers['x-notchpay-signature'];
        const webhookSecret = 'YOUR_WEBHOOK_SECRET';
        
        if (!verifyWebhookSignature(payload, signature, webhookSecret)) {
          return res.status(401).send('Invalid signature');
        }
        
        // Process the event
        const event = req.body;
        console.log('Received verified event:', event.type);
        
        res.status(200).send('Webhook received');
      });
      ```

      ```php PHP
      <?php
      function verifyWebhookSignature($payload, $signature, $secret) {
        $calculatedSignature = hash_hmac('sha256', $payload, $secret);
        return hash_equals($calculatedSignature, $signature);
      }
      
      // Get the request body
      $payload = file_get_contents('php://input');
      $signature = $_SERVER['HTTP_X_NOTCHPAY_SIGNATURE'];
      $webhookSecret = 'YOUR_WEBHOOK_SECRET';
      
      if (!verifyWebhookSignature($payload, $signature, $webhookSecret)) {
        http_response_code(401);
        echo 'Invalid signature';
        exit;
      }
      
      // Process the event
      $event = json_decode($payload, true);
      error_log('Received verified event: ' . $event['type']);
      
      http_response_code(200);
      echo 'Webhook received';
      ```

      ```python Python
      import hmac
      import hashlib
      
      def verify_webhook_signature(payload, signature, secret):
          calculated_signature = hmac.new(
              secret.encode('utf-8'),
              payload.encode('utf-8'),
              hashlib.sha256
          ).hexdigest()
          return hmac.compare_digest(calculated_signature, signature)
      
      @app.route('/webhooks/notchpay', methods=['POST'])
      def handle_webhook():
          payload = request.data.decode('utf-8')
          signature = request.headers.get('X-Notchpay-Signature')
          webhook_secret = 'YOUR_WEBHOOK_SECRET'
          
          if not verify_webhook_signature(payload, signature, webhook_secret):
              return jsonify(message='Invalid signature'), 401
          
          # Process the event
          event = request.json
          print(f"Received verified event: {event['type']}")
          
          return jsonify(message='Webhook received'), 200
      ```
    </CodeGroup>

    <Callout type="info">
      You can find your webhook secret in the Notch Pay dashboard under **Settings** > **Webhooks** > **View Details** for each webhook endpoint.
    </Callout>
  </Step>
  
  <Step title="Handle Webhook Events">
    Process different types of webhook events in your application:

    ```javascript
    app.post('/webhooks/notchpay', (req, res) => {
      // Verify signature (as shown above)
      
      const event = req.body;
      
      // Process the event based on its type
      switch (event.type) {
        case 'payment.complete':
          // Handle completed payment
          const payment = event.data;
          console.log(`Payment ${payment.reference} completed for ${payment.amount} ${payment.currency}`);
          // Update order status, send confirmation email, etc.
          break;
          
        case 'payment.failed':
          // Handle failed payment
          const failedPayment = event.data;
          console.log(`Payment ${failedPayment.reference} failed: ${event.message}`);
          // Notify customer, update order status, etc.
          break;
          
        case 'transfer.complete':
          // Handle completed transfer
          const transfer = event.data;
          console.log(`Transfer ${transfer.reference} completed for ${transfer.amount} ${transfer.currency}`);
          // Update payroll status, send notification, etc.
          break;
          
        // Handle other event types...
      }
      
      // Always return a 200 response quickly
      res.status(200).send('Webhook received');
    });
    ```

    <Callout type="warning">
      Always respond to webhook requests quickly with a 200 status code, even if your processing logic takes longer. Process events asynchronously when possible.
    </Callout>
  </Step>
  
  <Step title="Test Your Webhook">
    Test your webhook setup to ensure it's working correctly:

    1. In the Notch Pay dashboard, go to **Settings** > **Webhooks**
    2. Select your webhook endpoint
    3. Click **Send Test Event**
    4. Select an event type and click **Send**
    5. Check your server logs to confirm the event was received and processed

    You can also test webhooks by creating test payments or transfers using your test API keys.
  </Step>
</Steps>

## Webhook Event Types

<CardGroup cols={2}>
  <Card title="Payment Events" icon="credit-card">
    <ResponseField name="payment.created" type="event">
      Triggered when a payment is created
    </ResponseField>
    <ResponseField name="payment.processing" type="event">
      Triggered when a payment starts processing
    </ResponseField>
    <ResponseField name="payment.complete" type="event">
      Triggered when a payment status changes to "complete"
    </ResponseField>
    <ResponseField name="payment.failed" type="event">
      Triggered when a payment fails
    </ResponseField>
    <ResponseField name="payment.canceled" type="event">
      Triggered when a payment is canceled
    </ResponseField>
    <ResponseField name="payment.expired" type="event">
      Triggered when a payment expires
    </ResponseField>
  </Card>
  
  <Card title="Transfer Events" icon="money-bill-transfer">
    <ResponseField name="transfer.created" type="event">
      Triggered when a transfer is created
    </ResponseField>
    <ResponseField name="transfer.processing" type="event">
      Triggered when a transfer starts processing
    </ResponseField>
    <ResponseField name="transfer.complete" type="event">
      Triggered when a transfer status changes to "complete"
    </ResponseField>
    <ResponseField name="transfer.failed" type="event">
      Triggered when a transfer fails
    </ResponseField>
    <ResponseField name="transfer.canceled" type="event">
      Triggered when a transfer is canceled
    </ResponseField>
  </Card>
</CardGroup>

<CardGroup cols={2}>
  <Card title="Customer Events" icon="users">
    <ResponseField name="customer.created" type="event">
      Triggered when a customer is created
    </ResponseField>
    <ResponseField name="customer.updated" type="event">
      Triggered when a customer is updated
    </ResponseField>
  </Card>
  
  <Card title="Beneficiary Events" icon="user-plus">
    <ResponseField name="beneficiary.created" type="event">
      Triggered when a beneficiary is created
    </ResponseField>
    <ResponseField name="beneficiary.updated" type="event">
      Triggered when a beneficiary is updated
    </ResponseField>
  </Card>
</CardGroup>

## Webhook Event Structure

Each webhook event has the following structure:

<CodeGroup>
```json Webhook Event
{
  "id": "evt_123456789",
  "type": "payment.complete",
  "created_at": "2023-01-01T12:00:00Z",
  "data": {
    "id": "pay_123456789",
    "reference": "order_123",
    "amount": 5000,
    "currency": "XAF",
    "status": "complete",
    "customer": "cus_123456789",
    "created_at": "2023-01-01T12:00:00Z",
    "completed_at": "2023-01-01T12:05:00Z"
  }
}
```
</CodeGroup>

<ResponseField name="id" type="string">
  Unique identifier for the event
</ResponseField>

<ResponseField name="type" type="string">
  Type of the event (e.g., payment.complete, transfer.failed)
</ResponseField>

<ResponseField name="created_at" type="string">
  Timestamp when the event was created
</ResponseField>

<ResponseField name="data" type="object">
  The object related to the event (payment, transfer, customer, etc.)
</ResponseField>

## Best Practices

<CardGroup cols={2}>
  <Card title="Respond Quickly" icon="bolt" color="#16A34A">
    Always respond to webhook requests with a 200 status code as quickly as possible.
    
    Process events asynchronously to avoid timeouts.
  </Card>
  
  <Card title="Handle Retries" icon="rotate" color="#16A34A">
    Implement idempotent event processing to handle duplicate events.
    
    Store the event ID and check if you've already processed it before taking action.
  </Card>
  
  <Card title="Monitor Webhook Health" icon="heart-pulse" color="#16A34A">
    Regularly check your webhook logs in the Notch Pay dashboard to ensure they're being delivered correctly.
    
    Set up monitoring for your webhook endpoint to detect and alert on failures.
  </Card>
  
  <Card title="Use HTTPS" icon="lock" color="#16A34A">
    Always use HTTPS for your webhook endpoints to ensure secure data transmission.
    
    Keep your webhook secret secure and don't expose it in client-side code.
  </Card>
</CardGroup>

## Troubleshooting

<AccordionGroup>
  <Accordion title="Webhook Not Receiving Events">
    If your webhook endpoint isn't receiving events:
    
    1. Check that your endpoint is publicly accessible
    2. Verify that your server is accepting POST requests
    3. Ensure your endpoint responds with a 200 status code
    4. Check the webhook logs in the Notch Pay dashboard for delivery failures
    5. Verify that you've selected the correct events to receive
  </Accordion>
  
  <Accordion title="Signature Verification Failing">
    If signature verification is failing:
    
    1. Ensure you're using the correct webhook secret
    2. Check that you're verifying the signature correctly
    3. Make sure you're using the raw request body for verification
    4. Verify that your server isn't modifying the request body before verification
  </Accordion>
  
  <Accordion title="Duplicate Events">
    If you're receiving duplicate events:
    
    1. Implement idempotent event processing by storing event IDs
    2. Check if you've already processed an event before taking action
    3. Be aware that Notch Pay may retry webhook deliveries if your endpoint fails to respond
  </Accordion>
  
  <Accordion title="Missing Events">
    If you're missing events:
    
    1. Check the webhook logs in the Notch Pay dashboard
    2. Verify that your endpoint is responding with a 200 status code
    3. Ensure your server isn't experiencing downtime
    4. Check that you've subscribed to the correct event types
  </Accordion>
</AccordionGroup>

## Related Resources

<CardGroup cols={3}>
  <Card title="Webhooks API" icon="bell" href="/api-reference/webhooks">
    Manage webhook endpoints programmatically
  </Card>
  <Card title="Payments API" icon="credit-card" href="/api-reference/payments">
    Create and manage payments
  </Card>
  <Card title="Transfers API" icon="money-bill-transfer" href="/api-reference/transfers">
    Send money to beneficiaries
  </Card>
</CardGroup>